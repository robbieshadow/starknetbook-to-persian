# معماری

این مقدمه ای بر معماری لایه 2 Starknet است که برای کاربران مبتدی و با تجربه طراحی شده است. بر روی اجزای کلیدی تمرکز می کند: ترتیب دهنده ها، پروورها و گره ها.

Starknet یک سیستم هماهنگ است که هر جزء - Sequencer ها، Provers و Node ها - نقشی خاص و در عین حال به هم پیوسته را ایفا می کند. اگرچه Starknet هنوز به طور کامل غیرمتمرکز نشده است، اما فعالانه به سمت این هدف حرکت می کند. این درک از نقش ها و تعاملات درون سیستم به شما کمک می کند تا پیچیدگی های اکوسیستم Starknet را بهتر درک کنید.

### نمای کلی سطح بالا

عملیات Starknet زمانی شروع می شود که یک تراکنش توسط یک دروازه دریافت می شود که به عنوان Mempool عمل می کند. این مرحله همچنین می تواند توسط Sequencer مدیریت شود. تراکنش در ابتدا به عنوان "دریافت شده" علامت گذاری شده است. سپس Sequencer تراکنش را در وضعیت شبکه گنجانده و آن را با عنوان "ACCEPTED\_ON\_L2" برچسب گذاری می کند. مرحله آخر شامل Prover است که سیستم عامل را روی بلوک جدید اجرا می کند، اثبات آن را محاسبه می کند و آن را برای تأیید به لایه 1 (L1) ارسال می کند.

![Starknet Architecture](../img/ch03-architecture.png)

معماری Starknet

در اصل، معماری Starknet شامل چندین مؤلفه است:

* Sequencer مسئول دریافت تراکنش ها، سفارش آنها و تولید بلاک ها است. مانند اعتبار سنجی در اتریوم یا بیت کوین عمل می کند.
* Prover وظیفه دارد برای بلوک‌ها و تراکنش‌های ایجاد شده مدارک ایجاد کند. از ماشین مجازی قاهره برای اجرای برنامه‌های قابل اثبات استفاده می‌کند و در نتیجه ردیابی‌های اجرایی لازم برای تولید اثبات‌های STARK ایجاد می‌کند.
* لایه 1 (L1)، در این مورد اتریوم، میزبان یک قرارداد هوشمند است که می تواند این اثبات های STARK را تأیید کند. اگر شواهد معتبر باشند، ریشه حالت Starknet در L1 به روز می شود.

وضعیت Starknet یک عکس فوری جامع است که از طریق درختان Merkle نگهداری می شود، دقیقاً مانند اتریوم. این معماری رول آپ اعتبار و نقش های هر جزء را ایجاد می کند.

برای نگاهی عمیق تر به هر جزء، ادامه مطلب را بخوانید.

پس از کاوش در نمای کلی مقدماتی اجزای مختلف، با مراجعه به زیرفصل های اختصاصی آنها در این فصل، نقش های خاص آنها را عمیق تر کنید.

### ترتیب دهنده ها

ترتیب‌دهنده‌ها ستون فقرات شبکه استارک‌نت هستند، مشابه اعتباردهنده‌های اتریوم. آنها تراکنش ها را وارد سیستم می کنند.

مجموعه‌های اعتبار در بارگذاری برخی از کارهای شبکه، مانند بسته‌بندی و پردازش تراکنش‌ها، به بازیکنان تخصصی برتری دارند. این راه‌اندازی تا حدودی شبیه نحوه واگذاری امنیت اتریوم و بیت‌کوین به ماینرها است. توالی یابی، مانند استخراج، به منابع زیادی نیاز دارد.

برای شبکه‌هایی مانند Starknet و دیگر پلتفرم‌هایی که از Validity rollup استفاده می‌کنند، مشابهی مشابه ترسیم شده است. این شبکه ها پردازش تراکنش ها را به نهادهای تخصصی برون سپاری می کنند و سپس کار آنها را تأیید می کنند. این نهادهای تخصصی در زمینه گردآوری اعتبار به عنوان "Sequencer" شناخته می شوند.

Sequencer ها به جای ایجاد امنیت، همانطور که ماینرها انجام می دهند، ظرفیت تراکنش را فراهم می کنند. آنها چندین تراکنش را در یک دسته سفارش (توالی) می‌کنند، آنها را اجرا می‌کنند و بلوکی تولید می‌کنند که بعداً توسط Prover اثبات می‌شود و به عنوان یک اثبات منفرد و فشرده به شبکه Layer 1 ارسال می‌شود که به عنوان "rollup" شناخته می‌شود. به عبارت دیگر، همانطور که اعتبار سنجی ها در اتریوم و ماینرها در بیت کوین بازیگران تخصصی ایمن سازی شبکه هستند، شبکه های مبتنی بر جمع بندی روی اعتبارسنجی، بازیگران تخصصی هستند که ظرفیت تراکنش را فراهم می کنند.

این مکانیسم به مجموعه‌های Validity (یا ZK) اجازه می‌دهد تا حجم بیشتری از تراکنش‌ها را انجام دهند و در عین حال امنیت شبکه زیربنایی اتریوم را حفظ کنند. مقیاس پذیری را بدون به خطر انداختن امنیت افزایش می دهد.

ترتیب دهنده ها از یک روش سیستماتیک برای پردازش تراکنش پیروی می کنند:

1. ترتیب بندی: تراکنش ها را از کاربران جمع آوری می کنند و آنها را سفارش می دهند (توالی).
2. اجرا: ترتیب دهنده ها سپس این تراکنش ها را پردازش می کنند.
3. دسته بندی: تراکنش ها برای کارایی به صورت دسته ای یا بلوک ها گروه بندی می شوند.
4. تولید بلوک: ترتیب دهنده ها بلوک هایی را تولید می کنند که شامل دسته ای از تراکنش های پردازش شده است.

ترتیب دهنده ها باید قابل اعتماد و بسیار در دسترس باشند، زیرا نقش آنها برای عملکرد روان شبکه بسیار مهم است. آن‌ها به ماشین‌های قدرتمند و متصل نیاز دارند تا نقش خود را به طور مؤثر انجام دهند، زیرا باید تراکنش‌ها را سریع و پیوسته پردازش کنند.

نقشه راه فعلی Starknet شامل تمرکززدایی از نقش Sequencer است. این تغییر به سمت تمرکززدایی به شرکت‌کنندگان بیشتری اجازه می‌دهد تا Sequencer شوند و به استحکام شبکه کمک کنند.

برای جزئیات بیشتر در نقش Sequencer، به زیرفصل اختصاصی این فصل مراجعه کنید.

## Provers

پروورها به عنوان خط دوم تأیید در شبکه Starknet عمل می کنند. وظیفه اصلی آنها اعتبارسنجی کار Sequencer ها (زمانی که آنها بلوک تولید شده توسط Sequencer را دریافت می کنند) و ایجاد شواهدی است که این فرآیندها به درستی انجام شده اند.

وظایف یک پروور عبارتند از:

1. دریافت بلوک ها: پروورها بلوک هایی از تراکنش های پردازش شده را از Sequencers دریافت می کنند.
2. پردازش: پروورها این بلوک ها را برای بار دوم پردازش می کنند و اطمینان حاصل می کنند که تمام تراکنش های درون بلوک به درستی انجام شده است.
3. Proof Generation: پس از پردازش، Provers یک مدرک برای پردازش صحیح تراکنش ایجاد می کند.
4. ارسال مدرک به اتریوم: در نهایت مدرک برای اعتبار سنجی به شبکه اتریوم ارسال می شود. اگر اثبات درست باشد، شبکه اتریوم بلوک تراکنش ها را می پذیرد.

اثبات‌کننده‌ها حتی به قدرت محاسباتی بیشتری نسبت به Sequencer نیاز دارند، زیرا آنها باید اثبات‌ها را محاسبه و تولید کنند، فرآیندی که از نظر محاسباتی سنگین است. با این حال، کار Provers را می توان به چندین بخش تقسیم کرد که امکان موازی سازی و تولید اثبات کارآمد را فراهم می کند. فرآیند تولید اثبات ناهمزمان است، به این معنی که لازم نیست فورا یا در زمان واقعی اتفاق بیفتد. این انعطاف‌پذیری اجازه می‌دهد تا حجم کار بین چندین Prover توزیع شود. هر Prover می‌تواند روی یک بلوک متفاوت کار کند، که امکان موازی‌سازی و تولید اثبات کارآمد را فراهم می‌کند.

طراحی Starknet متکی بر این دو نوع بازیگر - Sequencers و Provers - است که برای اطمینان از پردازش کارآمد و تأیید امن تراکنش‌ها به صورت پشت سر هم کار می‌کنند.

برای جزئیات بیشتر در نقش Prover، به زیرفصل اختصاصی این فصل مراجعه کنید.

### بهینه‌سازی ترتیب‌دهنده‌ها و اثبات‌کننده‌ها: از بین بردن باورهای غلط رایج

رابطه بین Sequencer و Prover در فناوری بلاک چین اغلب باعث ایجاد بحث می شود. یک سوء تفاهم رایج نشان می دهد که یا Prover یا Sequencer گلوگاه اصلی است. برای درست کردن رکورد، اجازه دهید در مورد بهینه سازی هر دو مؤلفه بحث کنیم.

Starknet با استفاده از زبان برنامه نویسی قاهره، در حال حاضر فقط از تراکنش های متوالی پشتیبانی می کند. برنامه هایی برای معرفی تراکنش های موازی در آینده وجود دارد. با این حال، در حال حاضر، Sequencer یک تراکنش را در یک زمان اجرا می کند و آن را به گلوگاه در سیستم تبدیل می کند.

در مقابل، Provers به صورت ناهمزمان عمل می کند و می تواند چندین کار را به صورت موازی اجرا کند. استفاده از بازگشت اثباتی امکان توزیع کار در چندین ماشین را فراهم می کند و مقیاس پذیری را برای Provers کمتر مشکل می کند.

با توجه به ماهیت ناهمزمان و مقیاس پذیر Provers، تمرکز در Starknet به سمت افزایش کارایی Sequencer تغییر کرده است. این توضیح می‌دهد که چرا تلاش‌های توسعه کنونی عمدتاً در سمت توالی معادله است.

### گره ها

وقتی صحبت از تعریف کاری که گره ها در بیت کوین یا اتریوم انجام می دهند به میان می آید، مردم اغلب نقش آنها را به عنوان پیگیری هر تراکنش در شبکه به اشتباه تعبیر می کنند. با این حال، این کاملاً دقیق نیست.

گره ها به عنوان حسابرسان شبکه عمل می کنند و وضعیت شبکه را حفظ می کنند، مانند اینکه هر شرکت کننده چقدر بیت کوین دارد یا وضعیت فعلی یک قرارداد هوشمند خاص. آنها این کار را با پردازش تراکنش ها و حفظ رکورد همه تراکنش ها انجام می دهند، اما این وسیله ای برای رسیدن به هدف است، نه خود هدف.

در مجموعه Validity و به طور خاص در Starknet، این مفهوم تا حدودی معکوس شده است. گره ها لزوماً مجبور نیستند تراکنش ها را برای به دست آوردن وضعیت پردازش کنند. برخلاف اتریوم یا بیت‌کوین، گره‌های Starknet برای حفظ وضعیت شبکه نیازی به پردازش همه تراکنش‌ها ندارند.

دو راه اصلی برای دسترسی به داده های وضعیت شبکه وجود دارد: از طریق یک دروازه API یا استفاده از پروتکل RPC برای برقراری ارتباط با یک گره. کارکردن گره شخصی شما معمولاً سریعتر از استفاده از یک معماری مشترک مانند دروازه است. با گذشت زمان، Starknet قصد دارد API ها را منسوخ کند و آنها را با یک استاندارد JSON RPC جایگزین کند، و کارکردن گره خود را حتی سودمندتر کند.

شایان ذکر است که تشویق افراد بیشتر به اجرای گره‌ها، انعطاف‌پذیری شبکه را افزایش می‌دهد و از سیل سرور جلوگیری می‌کند، که در شبکه‌های دیگر L2 وجود دارد.

در حال حاضر، اساساً سه روش برای یک گره برای پیگیری وضعیت شبکه وجود دارد و می‌توانیم گره‌ها هر یک از این روش‌ها را پیاده‌سازی کنند:

1. بازپخش تراکنش های قدیمی: مانند اتریوم یا بیت کوین، یک گره می تواند تمام تراکنش ها را بگیرد و دوباره آنها را اجرا کند. اگرچه این روش دقیق است، اما مقیاس پذیر نیست مگر اینکه ماشین قدرتمندی داشته باشید که بتواند بار را مدیریت کند. اگر بتوانید همه تراکنش ها را دوباره پخش کنید، می توانید یک Sequencer شوید.
2. تکیه بر اجماع L2: گره ها می توانند به ترتیب دهنده(های) برای اجرای صحیح شبکه اعتماد کنند. هنگامی که Sequencer وضعیت را به روز می کند و یک بلوک جدید اضافه می کند، گره ها به روز رسانی را دقیق می پذیرند.
3. بررسی اعتبار اثبات در L1: گره ها می توانند با مشاهده L1 وضعیت شبکه را کنترل کنند و اطمینان حاصل کنند که هر بار که یک اثبات ارسال می شود، وضعیت به روز شده را دریافت می کنند. به این ترتیب، آنها مجبور نیستند به کسی اعتماد کنند و فقط باید آخرین تراکنش معتبر Starknet را پیگیری کنند.

هر نوع تنظیم گره دارای مجموعه ای از الزامات سخت افزاری و مفروضات اعتماد خاص خود است.

### گره هایی که تراکنش ها را دوباره پخش می کنند

گره هایی که تراکنش ها را دوباره پخش می کنند به ماشین های قدرتمندی برای ردیابی و اجرای تمام تراکنش ها نیاز دارند. این گره ها مفروضات اعتمادی ندارند. آنها تنها به تراکنش هایی که انجام می دهند متکی هستند و تضمین می کنند که وضعیت در هر نقطه معین معتبر است.

### گره هایی که به اجماع L2 متکی هستند

گره های متکی بر اجماع L2 به توان محاسباتی کمتری نیاز دارند. آنها برای حفظ وضعیت به فضای ذخیره سازی کافی نیاز دارند اما نیازی به پردازش تراکنش های زیادی ندارند. مبادله در اینجا یک فرض اعتماد است. در حال حاضر، Starknet حول یک Sequencer می چرخد، بنابراین این گره ها به Starkware اعتماد دارند تا شبکه را مختل نکند. با این حال، هنگامی که مکانیزم اجماع و انتخاب رهبر در میان ترتیب‌دهندگان برقرار شد، این گره‌ها فقط باید اعتماد کنند که Sequencer که سهام خود را برای تولید یک بلوک به اشتراک گذاشته است، مایل به از دست دادن آن نیست.

### گره هایی که اعتبار سنجی اثبات را در L1 بررسی می کنند

گره هایی که فقط وضعیت خود را بر اساس تأیید اعتبار در L1 به روز می کنند به کمترین سخت افزار نیاز دارند. آنها همان الزامات گره اتریوم را دارند و زمانی که گره های نور اتریوم به واقعیت تبدیل شوند، حفظ چنین گره ای می تواند به سادگی استفاده از یک گوشی هوشمند باشد. تنها معامله تاخیر است. اثبات‌ها در هر بلوک به اتریوم ارسال نمی‌شوند، بلکه به صورت متناوب و در نتیجه به‌روزرسانی‌های وضعیت با تأخیر انجام می‌شود. برنامه‌هایی برای تولید بیشتر اثبات‌ها وجود دارد، حتی اگر فوراً به اتریوم ارسال نشود و به این گره‌ها اجازه می‌دهد تأخیر خود را کاهش دهند. با این حال، این توسعه هنوز در نقشه راه Starknet فاصله دارد.

### نتیجه

از طریق این فصل، ما به ساختار Starknet می پردازیم و اهمیت Sequencer ها، Provers و Node ها را کشف می کنیم. هر کدام نقش منحصر به فردی را ایفا می کنند، اما با هم، شبکه ای بسیار مقیاس پذیر، کارآمد و ایمن ایجاد می کنند که گام مهمی به جلو در راه حل های لایه 2 است. همانطور که Starknet به سمت تمرکززدایی تکامل می یابد، درک این نقش ها بینش ارزشمندی را در مورد عملکرد داخلی این شبکه ارائه می دهد.

همانطور که ما بیشتر به دنیای Starknet می رویم، توقف بعدی ما کاوش در چرخه حیات تراکنش قبل از فرو رفتن در قلب کدنویسی با قاهره خواهد بود.

کتاب یک تلاش جامعه محور است که برای جامعه ایجاد شده است.

* اگر چیزی یاد گرفته‌اید یا نه، لطفاً چند لحظه وقت بگذارید و از طریق این نظرسنجی 3 سؤالی بازخورد خود را ارائه دهید.
* در صورت کشف هرگونه خطا یا پیشنهادات اضافی، در باز کردن مشکل در مخزن GitHub ما تردید نکنید.
