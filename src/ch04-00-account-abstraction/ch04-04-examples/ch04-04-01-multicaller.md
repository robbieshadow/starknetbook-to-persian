# حساب MultiCaller

توجه: این فصل برای انعکاس نحو جدید برای قراردادهای حساب باید به روز شود. لطفاً تا زمانی که این یادداشت حذف نشده است، از این فصل به عنوان مرجع استفاده نکنید.

مشارکت: این فصل فرعی نمونه ای از اعلام، استقرار و تعامل با قرارداد را ندارد. ما دوست داریم مشارکت شما را ببینیم! لطفا یک PR ارسال کنید.

Multicall یک تکنیک قدرتمند است که به چندین تماس تابع قرارداد هوشمند اجازه می دهد تا در یک تماس واحد جمع شوند و در نتیجه خروجی تلفیقی ایجاد شود. با ویژگی انتزاع حساب Starknet، تماس های چندگانه را می توان به طور یکپارچه در قراردادهای حساب ادغام کرد.

### چرا چند تماس؟

چند تماس در چندین سناریو مفید است. در اینجا چند نمونه آورده شده است:

1. تعویض توکن در صرافی های غیرمتمرکز: در یک عملیات تعویض توکن معمولی در یک صرافی غیرمتمرکز (DEX)، ابتدا باید هزینه توکن ها را تأیید کنید و سپس مبادله را آغاز کنید. اجرای جداگانه این عملیات از دیدگاه تجربه کاربر می تواند دشوار باشد. با چند تماس، این تماس‌ها را می‌توان در یک تراکنش ترکیب کرد و کار کاربر را ساده‌تر کرد.
2. واکشی داده‌های بلاک چین: زمانی که می‌خواهید قیمت دو توکن مختلف را از بلاک چین جویا شوید، مفید است که هر دو از یک بلوک برای یکپارچگی تهیه شوند. Multicall آخرین شماره بلوک را به همراه نتایج جمع آوری شده برمی گرداند و این سازگاری را فراهم می کند.

مزایای تراکنش های چند تماسی را می توان در زمینه انتزاع حساب بیشتر متوجه شد.

### قابلیت چند تماس در قراردادهای حساب

برای تسهیل تماس‌های چندگانه، می‌توانیم عملکردهای خاصی را در قرارداد حساب معرفی کنیم. در اینجا دو عملکرد اصلی وجود دارد:

### تابع \_execute\_calls

تابع \_execute\_calls مسئول اجرای چند تماس است. روی آرایه ای از فراخوانی ها تکرار می شود، آنها را اجرا می کند و نتایج را جمع می کند.

```rust
    fn _execute_calls(mut calls: Array<AccountCall>, mut res:Array::<Array::<felt>>) -> Array::<Array::<felt>> {
        match calls.pop_front() {
            Option::Some(call) => {
                let _res = _call_contract(call);
                res.append(_res);
                return _execute_calls(calls, res);
            },
            Option::None(_) => {
                return res;
            },
        }
    }
```

جدا از عملکرد سنتی execute، افزودن تابع \_execute\_calls به قرارداد حساب شما می تواند اطمینان حاصل کند که می توانید با استفاده از حساب قرارداد هوشمند خود یک تماس چندگانه برقرار کنید.

کد بالا یک نمونه ساده است که در آن "return execute\_calls(calls, res);" دستور فراخوانی بازگشتی با تابع \_execute\_calls برقرار می کند و در نتیجه تماس ها را با هم جمع می کند. نتیجه نهایی در متغیر _res_\*\* جمع شده و برگردانده می شود.

### تابع \_call\_contract

تابع \_call\_contract یک تابع کمکی است که برای برقراری تماس های قراردادی فردی استفاده می شود.

```rust
    fn _call_contract(call: AccountCall) -> Array::<felt> {
        starknet::call_contract_syscall(
            call.to, call.selector, call.calldata
        ).unwrap_syscall()
    }
```

### ملاحظات

در حالی که Multicall مزایای قابل توجهی از نظر UX و سازگاری داده دارد، مهم است که توجه داشته باشید که ممکن است به طور قابل توجهی هزینه های گاز را در مقایسه با تماس های فردی کاهش ندهد. با این حال، مزیت اصلی استفاده از چند تماس این است که تضمین می‌کند نتایج از یک بلوک مشتق شده‌اند و تجربه کاربری بسیار بهبود یافته‌ای را ارائه می‌دهند.

کتاب یک تلاش جامعه محور است که برای جامعه ایجاد شده است.

* اگر چیزی یاد گرفته‌اید یا نه، لطفاً چند لحظه وقت بگذارید و از طریق این نظرسنجی 3 سؤالی بازخورد خود را ارائه دهید.
* در صورت کشف هرگونه خطا یا پیشنهادات اضافی، در باز کردن مشکل در مخزن GitHub ما تردید نکنید.
